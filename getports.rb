#!/usr/bin/ruby

def getPorts(*arg)

  file_name = arg[0]
  s_ports = ""
  puts "[+] Extracting ports from #{file_name}",""
  nmapFile = File.open("#{file_name}");
  nmapFileData=nmapFile.read;
  puts "[+] Original data:",""
  puts  "#{nmapFileData}",""
  puts "[+] Ports extracted and assign to T_PORTS environment variable",""
  ports = nmapFileData.scan(/\d+\/open/)
  ports.each do |i|
    port = i.gsub("/open","")
    s_ports = "#{s_ports}" + "#{port}" + "," 
  end
  system("echo #{s_ports} > /tmp/env.tmp | export T_PORTS=$(cat /tmp/env.tmp)")
  puts "#{s_ports}"
  nmapFile.close
end

getPorts(ARGV[0])
